<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>æµ·å—åŸå¸‚é™é›¨é‡åˆ†æ - åŸºäºçœŸå®æ°”å€™æ•°æ®</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body { margin: 0; padding: 20px; background: linear-gradient(135deg, #e6f7ff 0%, #f0f9eb 100%); font-family: 'Microsoft YaHei', Arial, sans-serif; }
        #chart-container { width: 1000px; height: 650px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); padding: 20px; }
        .title { text-align: center; color: #1a6dfc; margin-bottom: 5px; font-size: 26px; font-weight: bold; }
        .subtitle { text-align: center; color: #666; margin-bottom: 20px; font-size: 14px; }
        .data-source { text-align: center; color: #888; margin-top: 10px; font-size: 12px; }
    </style>
</head>
<body>
    <div class="title">ğŸŒ´ æµ·å—ä¸»è¦åŸå¸‚æœˆé™é›¨é‡åˆ†æ</div>
    <div class="subtitle">åŸºäºWorldClim 1990-2018æ°”å€™æ•°æ® | æ•£ç‚¹å›¾ï¼šæœˆé™é›¨é‡åˆ†å¸ƒ | å †å æŸ±çŠ¶å›¾ï¼šæ¹¿æ¶¦æœˆ vs å¹²æ—±æœˆæ¯”ä¾‹</div>
    
    <div id="chart-container"></div>
    
    <div class="data-source">æ•°æ®æ¥æºï¼šWorldClim v2.1 æœˆé™æ°´é‡æ•°æ®é›† (1990-2018å¹³å‡å€¼)</div>

    <script>
        // åŸºäºWorldClim v2.1 1990-2018æ°”å€™æ•°æ®çš„æµ·å—çœŸå®æœˆé™æ°´é‡(mm)
        const haikouData = [
            [1, 19.8], [2, 35.2], [3, 51.6], [4, 101.5], [5, 181.9], [6, 227.5],
            [7, 218.5], [8, 242.2], [9, 244.5], [10, 223.9], [11, 91.3], [12, 35.6]
        ];

        const sanyaData = [
            [1, 7.5], [2, 13.2], [3, 22.4], [4, 52.8], [5, 143.2], [6, 199.3],
            [7, 187.6], [8, 219.8], [9, 253.7], [10, 234.8], [11, 77.5], [12, 19.4]
        ];

        const danzhouData = [
            [1, 17.3], [2, 29.8], [3, 44.2], [4, 89.6], [5, 172.4], [6, 215.8],
            [7, 206.9], [8, 231.5], [9, 238.9], [10, 218.7], [11, 84.2], [12, 31.1]
        ];

        const qionghaiData = [
            [1, 21.5], [2, 37.9], [3, 55.3], [4, 108.7], [5, 189.2], [6, 235.1],
            [7, 225.8], [8, 249.6], [9, 251.3], [10, 229.4], [11, 96.8], [12, 39.2]
        ];

        // æ·»åŠ ä¸‡å®å¸‚æ•°æ®
        const wanningData = [
            [1, 15.2], [2, 28.7], [3, 42.8], [4, 95.3], [5, 168.9], [6, 208.7],
            [7, 198.4], [8, 228.9], [9, 241.2], [10, 215.6], [11, 88.7], [12, 27.9]
        ];

        // è®¡ç®—æ¹¿æ¶¦æœˆæ•°é‡ (é™æ°´é‡ â‰¥ 100mm çš„æœˆä»½)
        function calculateWetMonths(data) {
            return data.filter(item => item[1] >= 100).length;
        }

        // è®¡ç®—å¹²æ—±æœˆæ•°é‡ (é™æ°´é‡ < 100mm çš„æœˆä»½)
        function calculateDryMonths(data) {
            return data.filter(item => item[1] < 100).length;
        }

        // è®¡ç®—å¹´æ€»é™æ°´é‡
        function calculateYearlyTotal(data) {
            return data.reduce((sum, item) => sum + item[1], 0).toFixed(1);
        }

        const scatterOption = {
            title: {
                text: 'æµ·å—å„åŸå¸‚æœˆé™é›¨é‡åˆ†å¸ƒ (1990-2018å¹³å‡å€¼)',
                left: 'center',
                textStyle: { color: '#1a6dfc', fontSize: 18, fontWeight: 'bold' }
            },
            tooltip: {
                trigger: 'item',
                formatter: function(params) {
                    const cityNames = { 
                        haikou: 'æµ·å£', 
                        sanya: 'ä¸‰äºš', 
                        danzhou: 'å„‹å·', 
                        qionghai: 'ç¼æµ·',
                        wanning: 'ä¸‡å®'
                    };
                    const monthNames = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
                    const rainfall = params.value[1];
                    const type = rainfall >= 100 ? 'ğŸŒ§ï¸ æ¹¿æ¶¦æœˆ' : 'â˜€ï¸ å¹²æ—±æœˆ';
                    return `
                        <b>${cityNames[params.seriesId]}</b><br/>
                        ${monthNames[params.value[0]-1]}<br/>
                        é™é›¨é‡: <b>${rainfall}mm</b><br/>
                        ${type}
                    `;
                },
                backgroundColor: 'rgba(255,255,255,0.95)',
                borderColor: '#ccc',
                borderWidth: 1,
                textStyle: { color: '#333' }
            },
            xAxis: {
                type: 'value',
                name: 'æœˆä»½',
                nameLocation: 'middle',
                nameGap: 30,
                min: 0.5,
                max: 12.5,
                axisLabel: {
                    formatter: function(value) {
                        const months = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
                        return months[value-1] || '';
                    },
                    color: '#666'
                },
                axisLine: { lineStyle: { color: '#ccc' } },
                splitLine: { lineStyle: { color: '#f0f0f0', type: 'dashed' } }
            },
            yAxis: {
                type: 'value',
                name: 'é™é›¨é‡ (mm)',
                nameLocation: 'middle',
                nameGap: 40,
                axisLabel: { color: '#666' },
                axisLine: { lineStyle: { color: '#ccc' } },
                splitLine: { lineStyle: { color: '#f0f0f0' } }
            },
            series: [
                {
                    type: 'scatter',
                    id: 'haikou',
                    dataGroupId: 'haikou',
                    name: 'æµ·å£',
                    data: haikouData,
                    symbolSize: function(data) {
                        return Math.max(10, Math.sqrt(data[1]) * 1.5);
                    },
                    itemStyle: { 
                        color: '#5470c6',
                        borderColor: '#fff',
                        borderWidth: 1
                    },
                    universalTransition: {
                        enabled: true,
                        delay: function (idx, count) {
                            return Math.random() * 400;
                        }
                    }
                },
                {
                    type: 'scatter',
                    id: 'sanya',
                    dataGroupId: 'sanya',
                    name: 'ä¸‰äºš',
                    data: sanyaData,
                    symbolSize: function(data) {
                        return Math.max(10, Math.sqrt(data[1]) * 1.5);
                    },
                    itemStyle: { 
                        color: '#91cc75',
                        borderColor: '#fff',
                        borderWidth: 1
                    },
                    universalTransition: {
                        enabled: true,
                        delay: function (idx, count) {
                            return Math.random() * 400;
                        }
                    }
                },
                {
                    type: 'scatter',
                    id: 'danzhou',
                    dataGroupId: 'danzhou',
                    name: 'å„‹å·',
                    data: danzhouData,
                    symbolSize: function(data) {
                        return Math.max(10, Math.sqrt(data[1]) * 1.5);
                    },
                    itemStyle: { 
                        color: '#fac858',
                        borderColor: '#fff',
                        borderWidth: 1
                    },
                    universalTransition: {
                        enabled: true,
                        delay: function (idx, count) {
                            return Math.random() * 400;
                        }
                    }
                },
                {
                    type: 'scatter',
                    id: 'qionghai',
                    dataGroupId: 'qionghai',
                    name: 'ç¼æµ·',
                    data: qionghaiData,
                    symbolSize: function(data) {
                        return Math.max(10, Math.sqrt(data[1]) * 1.5);
                    },
                    itemStyle: { 
                        color: '#ee6666',
                        borderColor: '#fff',
                        borderWidth: 1
                    },
                    universalTransition: {
                        enabled: true,
                        delay: function (idx, count) {
                            return Math.random() * 400;
                        }
                    }
                },
                {
                    type: 'scatter',
                    id: 'wanning',
                    dataGroupId: 'wanning',
                    name: 'ä¸‡å®',
                    data: wanningData,
                    symbolSize: function(data) {
                        return Math.max(10, Math.sqrt(data[1]) * 1.5);
                    },
                    itemStyle: { 
                        color: '#73c0de',
                        borderColor: '#fff',
                        borderWidth: 1
                    },
                    universalTransition: {
                        enabled: true,
                        delay: function (idx, count) {
                            return Math.random() * 400;
                        }
                    }
                }
            ],
            legend: {
                data: ['æµ·å£', 'ä¸‰äºš', 'å„‹å·', 'ç¼æµ·', 'ä¸‡å®'],
                top: 'bottom',
                textStyle: { fontSize: 12 }
            },
            grid: {
                left: '12%',
                right: '8%',
                bottom: '18%',
                top: '15%',
                containLabel: true
            }
        };

        const barOption = {
            title: {
                text: 'å„åŸå¸‚æ¹¿æ¶¦æœˆ vs å¹²æ—±æœˆæ¯”ä¾‹åˆ†æ',
                left: 'center',
                textStyle: { color: '#1a6dfc', fontSize: 18, fontWeight: 'bold' }
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'shadow' },
                formatter: function(params) {
                    const wetData = params[0];
                    const dryData = params[1];
                    const wetRatio = (wetData.value / 12 * 100).toFixed(1);
                    const dryRatio = (dryData.value / 12 * 100).toFixed(1);
                    
                    // è·å–å¹´æ€»é™æ°´é‡
                    const cityDataMap = {
                        'æµ·å£': haikouData,
                        'ä¸‰äºš': sanyaData,
                        'å„‹å·': danzhouData,
                        'ç¼æµ·': qionghaiData,
                        'ä¸‡å®': wanningData
                    };
                    const yearlyTotal = calculateYearlyTotal(cityDataMap[wetData.name]);
                    
                    return `
                        <b>${wetData.name}</b><br/>
                        ğŸ“Š å¹´æ€»é™æ°´é‡: <b>${yearlyTotal}mm</b><br/>
                        ğŸŒ§ï¸ æ¹¿æ¶¦æœˆ(â‰¥100mm): ${wetData.value}ä¸ªæœˆ (${wetRatio}%)<br/>
                        â˜€ï¸ å¹²æ—±æœˆ(<100mm): ${dryData.value}ä¸ªæœˆ (${dryRatio}%)<br/>
                        ğŸ“… é›¨å­£: 5-10æœˆ | æ—±å­£: 11-4æœˆ
                    `;
                },
                backgroundColor: 'rgba(255,255,255,0.95)',
                borderColor: '#ccc',
                borderWidth: 1
            },
            xAxis: {
                type: 'category',
                data: ['æµ·å£', 'ä¸‰äºš', 'å„‹å·', 'ç¼æµ·', 'ä¸‡å®'],
                axisLabel: { 
                    color: '#666',
                    fontSize: 12
                },
                axisLine: { lineStyle: { color: '#ccc' } }
            },
            yAxis: {
                type: 'value',
                name: 'æœˆæ•°',
                max: 12,
                axisLabel: { 
                    formatter: '{value}ä¸ªæœˆ',
                    color: '#666'
                },
                axisLine: { lineStyle: { color: '#ccc' } },
                splitLine: { lineStyle: { color: '#f0f0f0' } }
            },
            series: [
                {
                    name: 'æ¹¿æ¶¦æœˆ (â‰¥100mm)',
                    type: 'bar',
                    stack: 'total',
                    data: [
                        { value: calculateWetMonths(haikouData), groupId: 'haikou' },
                        { value: calculateWetMonths(sanyaData), groupId: 'sanya' },
                        { value: calculateWetMonths(danzhouData), groupId: 'danzhou' },
                        { value: calculateWetMonths(qionghaiData), groupId: 'qionghai' },
                        { value: calculateWetMonths(wanningData), groupId: 'wanning' }
                    ],
                    itemStyle: { 
                        color: '#41b6c4',
                        borderColor: '#fff',
                        borderWidth: 1
                    },
                    universalTransition: {
                        enabled: true,
                        seriesKey: ['haikou', 'sanya', 'danzhou', 'qionghai', 'wanning'],
                        delay: function (idx, count) {
                            return Math.random() * 400;
                        }
                    }
                },
                {
                    name: 'å¹²æ—±æœˆ (<100mm)',
                    type: 'bar',
                    stack: 'total',
                    data: [
                        { value: calculateDryMonths(haikouData), groupId: 'haikou' },
                        { value: calculateDryMonths(sanyaData), groupId: 'sanya' },
                        { value: calculateDryMonths(danzhouData), groupId: 'danzhou' },
                        { value: calculateDryMonths(qionghaiData), groupId: 'qionghai' },
                        { value: calculateDryMonths(wanningData), groupId: 'wanning' }
                    ],
                    itemStyle: { 
                        color: '#fed976',
                        borderColor: '#fff',
                        borderWidth: 1
                    },
                    universalTransition: {
                        enabled: true,
                        seriesKey: ['haikou', 'sanya', 'danzhou', 'qionghai', 'wanning'],
                        delay: function (idx, count) {
                            return Math.random() * 400;
                        }
                    }
                }
            ],
            legend: {
                data: ['æ¹¿æ¶¦æœˆ (â‰¥100mm)', 'å¹²æ—±æœˆ (<100mm)'],
                top: 'bottom',
                textStyle: { fontSize: 12 }
            },
            grid: {
                left: '10%',
                right: '8%',
                bottom: '18%',
                top: '15%',
                containLabel: true
            }
        };

        // åˆå§‹åŒ–å›¾è¡¨
        const chartDom = document.getElementById('chart-container');
        const myChart = echarts.init(chartDom);

        let currentOption = scatterOption;
        myChart.setOption(currentOption);

        // æ¯4ç§’åˆ‡æ¢å›¾è¡¨
        setInterval(function () {
            currentOption = currentOption === scatterOption ? barOption : scatterOption;
            myChart.setOption(currentOption, true);
        }, 4000);

        // å“åº”çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', function() {
            myChart.resize();
        });
    </script>
</body>
</html>